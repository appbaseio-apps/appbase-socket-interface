<!doctype html>
<html>
  <head>
    <title>Appbase.io + Socket.io</title>
	
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">
	
    <style>
	#header {
		background-color:black;
		color:white;
		text-align:center;
		padding:5px;
	}
	#nav {
		line-height:30px;
		background-color:#eeeeee;
		height:300px;
		width:100px;
		float:left;
		padding:5px;	      
	}
	#footer {
		background-color:#eeeeee;
		color:white;
		clear:both;
		text-align:center;
	   padding:5px;	 	 
	}

	body { font: 13px Helvetica, Arial; }
	form input { border: 1; padding: 10px; width: 90%; margin-bottom: .5%; }
	form button { width: 9%; background: rgb(130, 224, 255); border: none; padding: 10px; }
	#messages { list-style-type: none; margin: 0; padding: 0; }
	#messages li { padding: 5px 10px; }
	#messages li:nth-child(odd) { background: #eee; }
    </style>

  </head>
  <body>

	<div id="header">
		<h1>Appbase.io + Socket.io</h1>
	</div>

	<div id="nav">
		<p id="approved_subcount"></p>
		<button id="subscribe_approved">Subscribe to Approved Post</button>
		<p/>
		<p id="pending_subcount"></p>
		<button id="subscribe_pending">Subscribe to Pending Post</button>
		<p/>
		<button id="approve_pending">Approve All Pending Post</button>
	</div>

	<div id="section" class="ui-grid-a">
		<div id="left_col" class="ui-block-a">
			<a class="ui-btn ui-corner-all ui-shadow">User Dashboard</a><br>
			<ul id="approved_posts" style="border: 1px solid black" width="auto"></ul>
		</div>

		<div id="right_col" class="ui-block-b">
			<a class="ui-btn ui-corner-all ui-shadow">Admin Dashboard</a><br>
			<ul id="pending_posts" style="border: 1px solid black"></ul>
		</div>
	</div>

	<div id="footer">
		<form action="">
			<select name="role" style="background-color:#ff0000;">
				<option value="guest">guest</option>
				<option value="user">user</option>
				<option value="admin">admin</option>
			</select>
			<br/>
			<br/>
			Title:<br/>
			<input id="title" autocomplete="off" /> <br/>
			Body:<br/>
			<input id="post" autocomplete="off" />
			<button>Send</button>
		</form>
	</div>


    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
      var socket = io();

      $('form').submit(function(){
		var jsonObject = {
				"role":$("select option:selected").text(),
				"title":$('#title').val(),
				"post":$('#post').val()
			};

        socket.emit('on_blog_post', jsonObject);
        $('#title').val('');
        $('#post').val('');
        return false;
      });

	  $("#subscribe_approved").click(function() {
		var jsonObject = {
			"role":$("select option:selected").text()
		};
			
        socket.emit('subscribe_approved', jsonObject);
	  });
	  
	  $("#subscribe_pending").click(function(){
		var jsonObject = {
			"role":$("select option:selected").text()
		};
		socket.emit('subscribe_pending', jsonObject);
	  });
	  
	  $("#approve_pending").click(function(){
		var jsonObject = {
			"role":$("select option:selected").text()
		};
		socket.emit('approve_pending', jsonObject);
	  });

      socket.on('blog_post_approved', function(msg){
        $('#approved_posts').append($('<li>').text('{Title:' + msg.title + ', Post: ' + msg.post + '}'));
      });
	  
	  socket.on('blog_post_created', function(msg){
        $('#pending_posts').append($('<li>').text('{Title:' + msg.title + ', Post: ' + msg.post + '}'));
      });

	  socket.on('pending_subscribeCount', function(msg){
		$('#pending_subcount').text(msg);
	  });
	  
	  socket.on('approved_subscribeCount', function(msg){
		$('#approved_subcount').text(msg);
	  });
	  
	  socket.on('failure', function(msg){
		alert(msg);
	  });
	  
	  socket.on('success', function(msg){
		alert(msg);
	  });
    </script>
  </body>
</html>
